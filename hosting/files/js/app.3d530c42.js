(function(t){function e(e){for(var a,n,o=e[0],c=e[1],l=e[2],d=0,m=[];d<o.length;d++)n=o[d],r[n]&&m.push(r[n][0]),r[n]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(m.length)m.shift()();return i.push.apply(i,l||[]),s()}function s(){for(var t,e=0;e<i.length;e++){for(var s=i[e],a=!0,o=1;o<s.length;o++){var c=s[o];0!==r[c]&&(a=!1)}a&&(i.splice(e--,1),t=n(n.s=s[0]))}return t}var a={},r={app:0},i=[];function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=a,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;i.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"0921":function(t,e,s){},"0a56":function(t,e,s){},1692:function(t,e,s){},"180a":function(t,e,s){"use strict";var a=s("c58d"),r=s.n(a);r.a},"1ab2":function(t,e,s){"use strict";var a=s("ad48"),r=s.n(a);r.a},"245f":function(t,e,s){},"2d6e":function(t,e,s){"use strict";var a=s("245f"),r=s.n(a);r.a},"36d0":function(t,e,s){},"3d00":function(t,e,s){},4661:function(t,e,s){"use strict";var a=s("0921"),r=s.n(a);r.a},"47d6":function(t,e,s){"use strict";var a=s("36d0"),r=s.n(a);r.a},"4c92":function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("7f7f"),s("20d6"),s("ac6a"),s("cadf"),s("551c"),s("f751"),s("097d");var a=s("a026"),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},i=[],n=s("289d"),o=(s("5abe"),s("2f62")),c=s("db49"),l=s.n(c);a["a"].use(n["a"]),a["a"].use(o["a"]);var u={name:l.a.appName,data:function(){return{}}},d=u,m=s("2877"),p=Object(m["a"])(d,r,i,!1,null,null,null),f=p.exports,h=s("8c4f"),v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home"},[s("MyHeader",{attrs:{homePage:!0},on:{"search-term":t.search}}),s("section",{staticClass:"section"},[t.stitchReady?s("div",{staticClass:"columns"},[t.windowWidth>=800?s("div",{staticClass:"column is-3 restrict-height"},[s("div",{staticClass:"container"},[s("CategoryMenu")],1)]):t._e(),s("div",{staticClass:"column scroll",attrs:{id:"products"}},[s("div",{staticClass:"container"},[s("ProductCards",{attrs:{path:t.path,searchTerm:t.searchTerm}})],1)])]):t._e()])],1)},g=[],C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("header",[s("section",{staticClass:"hero is-primary is-small"},[s("div",{staticClass:"hero-head"},[s("nav",{staticClass:"navbar"},[s("div",{staticClass:"container"},[s("div",{staticClass:"navbar-brand"},[t._m(0),s("div",{staticClass:"navbar-burger burger",class:{"is-active":t.showBurgerNav},attrs:{"data-target":""},on:{click:function(e){t.showBurgerNav=!t.showBurgerNav}}},[s("span"),s("span"),s("span")])]),s("div",{staticClass:"navbar-menu",class:{"is-active":t.showBurgerNav},attrs:{id:""}},[s("div",{staticClass:"navbar-end"},[s("a",{staticClass:"navbar-item",on:{click:t.gotoHome}},[t._v("\n                        Home\n                    ")]),t.homePage?s("div",{staticClass:"field",attrs:{id:"search-box"}},[s("div",{staticClass:"control has-icons-right"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchTerm,expression:"searchTerm"}],staticClass:"input is-small",attrs:{type:"text",placeholder:"Search for products"},domProps:{value:t.searchTerm},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)},input:function(e){e.target.composing||(t.searchTerm=e.target.value)}}}),s("span",{staticClass:"icon is-small is-right",on:{click:t.search}},[s("i",{staticClass:"fas fa-search"})])])]):t._e(),t.customer.mugshotURL?s("a",{staticClass:"navbar-item"},[s("figure",{staticClass:"image is-24x24"},[s("img",{staticClass:"is-rounded",attrs:{src:t.customer.mugshotURL},on:{click:t.gotoUserAccount}})])]):t._e(),t.userLoggedIn?s("a",{staticClass:"navbar-item",on:{click:t.gotoUserAccount}},[s("span",[t._v(t._s(t.userFirstName)+"'s account")])]):s("a",{staticClass:"navbar-item"},[s("span",{on:{click:t.showLoginModal}},[t._v("Login/Register")])]),t.userLoggedIn?s("a",{staticClass:"navbar-item"},[s("span",{on:{click:t.signout}},[t._v("Sign out")])]):t._e(),t.metaCustomer.shoppingBasketSize>0?s("a",{staticClass:"navbar-item",on:{click:t.openBasket}},[t._m(1),s("span",[s("small",[t._v(t._s(t.metaCustomer.shoppingBasketSize))]),t._v(" Checkout")])]):t._e(),t._m(2)])])])])]),t._m(3)])]),s("body",[s("AnonymousAuth"),s("div",{staticClass:"container"},[t.loginModalVisible?s("div",{staticClass:"modal is-active",on:{"close-modal":t.hideLoginModal}},[s("div",{staticClass:"modal-background"}),s("div",{staticClass:"modal-content"},[s("UserLogin",{on:{"close-modal":t.hideLoginModal}}),s("button",{staticClass:"modal-close is-large",attrs:{"aria-label":"close"},on:{click:t.hideLoginModal}})],1)]):t._e()])],1)])},b=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a",{staticClass:"navbar-item"},[a("img",{attrs:{src:s("c316"),alt:"Logo"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon"},[s("i",{staticClass:"fas fa-shopping-cart"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"navbar-item"},[s("a",{staticClass:"button is-black",attrs:{href:"https://github.com/am-MongoDB/eCommerce",target:"_blank"}},[s("span",{staticClass:"icon"},[s("i",{staticClass:"fab fa-github"})]),s("span",[t._v("Source")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"hero-body"},[s("div",{staticClass:"container has-text-centered"},[s("p",{staticClass:"title"},[t._v("\n                MongoDB Store\n            ")]),s("p",{staticClass:"subtitle"},[t._v("\n                An eCommerce store built on MongoDB Atlas and Stitch\n            ")])])])}],y=(s("8e6e"),s("456d"),s("bd86")),_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("Status",{attrs:{status:t.status}})],1)},w=[],O=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.componentStatus?s("div",{staticClass:"notification",class:{"is-primary":"progress"==t.componentStatus.state,"is-success":"success"==t.componentStatus.state,"is-danger":"error"==t.componentStatus.state}},[t._v("\n        "+t._s(t.componentStatus.text)+"\n    ")]):t._e()},k=[],P=s("5118"),j={name:"status",props:["status"],data:function(){return{componentStatus:null}},watch:{status:function(t){var e=this;this.componentStatus=t,t&&"error"===t.state&&l.a.logErrors&&console.error(t.text),t&&t.time&&Object(P["setTimeout"])(function(){e.componentStatus=null},t.time)}},mounted:function(){this.componentStatus=this.status}},$=j,x=Object(m["a"])($,O,k,!1,null,null,null),S=x.exports,I=s("9069");function D(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function E(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?D(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):D(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var R={name:"AnonymousAuth",components:{Status:S},data:function(){return{status:null,localStitchClient:{}}},methods:E({},Object(o["b"])(["refreshCustomer"]),{anonymousLogin:function(){var t=this;this.localStitchClient.auth.isLoggedIn?(this.$root.$data.stitchClient=this.localStitchClient,this.connectDatabase()):(this.status={state:"progress",text:"Authing app..."},this.localStitchClient.auth.loginWithCredential(new I["a"]).then(function(){t.status=null,t.connectDatabase(),t.$root.$data.stitchClient=t.localStitchClient}).catch(function(e){t.status={state:"error",text:"Anonymous Stitch authentication failed: ".concat(e)}}))},connectDatabase:function(){try{var t=this.localStitchClient.getServiceClient(I["b"].factory,"mongodb-atlas").db(l.a.database);this.$root.$data.database=t,this.refreshCustomer(this.$root.$data.database)}catch(e){this.status={state:"error",text:"Failed to connect to the database: ".concat(e)}}}}),mounted:function(){try{this.localStitchClient=I["c"].getAppClient(l.a.appId)}catch(t){this.localStitchClient=I["c"].initializeDefaultAppClient(l.a.appId)}this.anonymousLogin()}},B=R,T=Object(m["a"])(B,_,w,!1,null,null,null),A=T.exports,F=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",attrs:{id:"login",tabindex:"0"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.quit(e)}}},[s("div",{staticClass:"notification is-primary"},[s("h1",{staticClass:"title is-2"},[t._v("Log into your existing account")]),s("div",{staticClass:"field is-horizontal"},[s("div",{staticClass:"field-body"},[s("div",{staticClass:"field is-expanded"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],ref:"email",staticClass:"input",attrs:{type:"email",placeholder:"Email"},domProps:{value:t.email},on:{input:function(e){e.target.composing||(t.email=e.target.value)}}}),t._m(0)])])]),s("div",{staticClass:"field is-expanded"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"input",attrs:{type:"password",placeholder:"Password"},domProps:{value:t.password},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.Login(e)},input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._m(1)])])])])]),s("div",{staticClass:"field is-grouped is-grouped-centered"},[s("p",{staticClass:"control"},[s("button",{staticClass:"button is-success is-medium is-focused",on:{click:t.Login}},[t._m(2),s("span",[t._v("Login")])])]),s("p",{staticClass:"control"},[s("router-link",{attrs:{to:"/register"}},[s("button",{staticClass:"button is-medium has-background-grey-lighter"},[s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-edit"})]),s("span",[t._v("Register a new account")])])])],1)])]),s("Status",{attrs:{status:t.status}})],1)},L=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-envelope"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-key"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-check"})])}];function N(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function M(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?N(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):N(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var U={name:"UserLogin",components:{Status:S},data:function(){return{status:null,email:"",password:""}},methods:M({},Object(o["b"])(["setUserLoggedIn"]),{Login:function(){var t=this;this.status={state:"progress",text:"Attempting to log you in..."};var e=new I["e"](this.email,this.password);this.$root.$data.stitchClient.auth.loginWithCredential(e).then(function(e){t.$store.dispatch("setUserLoggedIn",{database:t.$root.$data.database,user:e}).then(function(){t.status=null,t.$emit("close-modal")},function(e){t.status={state:"error",text:"Failed to log in user: ".concat(e)}})},function(e){t.status={state:"error",text:"Failed to log in user: ".concat(e)}})},quit:function(){this.$emit("close-modal")}}),mounted:function(){this.$refs.email.focus()}},q=U,H=(s("180a"),Object(m["a"])(q,F,L,!1,null,"13544472",null)),W=H.exports;function z(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function V(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?z(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):z(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var Q={name:"Header",props:["homePage"],components:{AnonymousAuth:A,UserLogin:W},data:function(){return{loginModalVisible:!1,showBurgerNav:!1,searchTerm:""}},computed:V({},Object(o["d"])(["customer","metaCustomer","userFirstName","userLoggedIn"])),methods:V({},Object(o["c"])(["signout"]),{showLoginModal:function(){this.loginModalVisible=!0},hideLoginModal:function(){this.loginModalVisible=!1},gotoUserAccount:function(){this.userLoggedIn&&this.$router.push({name:"account"})},gotoHome:function(){this.$router.push({name:"home"})},openBasket:function(){this.userLoggedIn?this.$router.push({name:"basket"}):this.showLoginModal()},search:function(){this.$emit("search-term",this.searchTerm)}})},K=Q,Y=(s("8932"),Object(m["a"])(K,C,b,!1,null,"0b7c44a8",null)),G=Y.exports,J=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("section",{staticClass:"section",attrs:{id:"product-cards"}},[s("ul",{attrs:{id:"product-list"}},t._l(t.products,function(e){return s("li",{key:e.productId},[s("a",{on:{click:function(s){return t.jumpToProduct(e.productID)}}},[s("ProductCard",{attrs:{product:e}})],1)])}),0)]),s("br"),s("Status",{attrs:{status:t.status}})],1)},X=[],Z=(s("7514"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"box"},[s("article",{staticClass:"media"},[s("div",{staticClass:"media-left"},[s("figure",{staticClass:"image is-128x128"},[s("img",{attrs:{src:t.product.productImages[0]}})])]),s("div",{staticClass:"media-content"},[s("div",[s("h6",{staticClass:"title is-6"},[t._v(t._s(t.product.productName))]),t.product.category?s("span",{staticClass:"tag"},[t._v(t._s(t.product.category))]):t._e(),s("p",[s("strong",[t._v("$"+t._s(t.product.price.sale.toFixed(2)))]),t.product.price.list>t.product.price.sale?s("span",[s("small",[t._v(" Reduced from $"+t._s(t.product.price.list.toFixed(2)))])]):t._e()]),s("div",[s("p",{domProps:{innerHTML:t._s(t.productSummary)}})]),s("Rank",{attrs:{score:t.product.reviews.averageReviewScore,numberReviews:t.product.reviews.numberOfReviews}})],1)])])])])}),tt=[],et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.numberReviews>0?s("div",{staticClass:"columns"},[s("div",{staticClass:"column",attrs:{id:"review-bar"}},[s("progress",{staticClass:"progress is-warning",attrs:{max:"5"},domProps:{value:t.score}})]),s("div",{staticClass:"column is-narrow"},[s("small",[t._v(t._s(t.productRating)+"/5 ("+t._s(t.numberReviews)+" review"),t.numberReviews>1?s("span",[t._v("s")]):t._e(),t._v(") ")])])]):t._e()])},st=[],at={name:"Rank",props:["score","numberReviews"],components:{},data:function(){return{productRating:0}},created:function(){this.score===Math.round(this.score)?this.productRating=this.score:this.productRating=this.score.toFixed(1)}},rt=at,it=(s("4661"),Object(m["a"])(rt,et,st,!1,null,"03ecfb8a",null)),nt=it.exports,ot={name:"ProductCard",props:["product"],components:{Rank:nt},data:function(){return{productSummary:""}},methods:{highlightText:function(t){var e="";return t.forEach(function(t){t.texts.forEach(function(t){"hit"==t.type?e+='<span class="has-text-primary has-text-weight-bold">'.concat(t.value,"</span>"):e+=t.value}),e+=" "}),e},prepareProductData:function(){this.product.highlights?this.productSummary=this.highlightText(this.product.highlights).substring(0,450)+"...":this.productSummary=this.product.description.substring(0,300)+"..."}},created:function(){this.prepareProductData()}},ct=ot,lt=(s("bd78"),Object(m["a"])(ct,Z,tt,!1,null,"047948f8",null)),ut=lt.exports;function dt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function mt(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?dt(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):dt(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var pt={name:"ProductCards",props:["searchTerm"],components:{ProductCard:ut,Status:S},data:function(){return{status:null,products:[],bouncable:!1,lastProductID:"",lastInterest:1e4,lastScore:1e4,localSearchTerm:""}},computed:mt({},Object(o["d"])(["categoryFilter"])),watch:{categoryFilter:function(){this.lastProductID="",this.lastInterest=1e4,this.products=[],this.fetchProductList(),this.localSearchTerm=""},searchTerm:function(t){this.localSearchTerm=t,this.lastProductID="",this.lastInterest=1e4,this.lastScore=1e4,this.products=[],this.searchProducts()}},methods:{jumpToProduct:function(t){window.onscroll=function(){},this.$router.push({name:"product",query:{productID:t}})},fetchProductList:function(){var t=this;this.status={state:"progress",text:"Fetching product list"},this.bouncable=!1;var e={$or:[{interest:{$lt:this.lastInterest}},{$and:[{interest:{$eq:this.lastInterest}},{productID:{$gt:this.lastProductID}}]}]};if(this.categoryFilter.length>0){for(var s=[],a=0;a<this.categoryFilter.length;a++){var r="categoryHierarchy.".concat(a+1),i={};i[r]=this.categoryFilter[a],s.push(i)}e.$and=[{$and:s}]}this.$root.$data.database.collection("products").find(e,{projection:{_id:0,productID:1,productName:1,description:1,category:1,productImages:1,price:1,interest:1,"reviews.averageReviewScore":1,"reviews.numberOfReviews":1},sort:{interest:-1,productID:1},limit:20}).toArray().then(function(e){if(e.length>0){t.lastProductID=e[e.length-1].productID,t.lastInterest=e[e.length-1].interest,e.forEach(function(e){t.products.push(e)}),t.status=null;var s=t;setTimeout(function(){s.bouncable=!0},500)}else t.status={state:"success",text:"No more matching products."}},function(e){t.status={state:"error",text:"Error: Failed to read the list of products – ".concat(e)}})},searchProducts:function(){var t=this;this.status={state:"progress",text:"Searching for matching products"},this.bouncable=!1,this.$root.$data.database.collection("products").aggregate([{$searchBeta:{index:"Titles and descriptions",compound:{must:{search:{query:this.localSearchTerm,path:"description"}},should:Object(y["a"])({search:{query:this.localSearchTerm,path:"productName"}},"search",{query:this.localSearchTerm,path:"category"})},highlight:{path:"description"}}},{$project:{_id:0,productName:1,description:1,productID:1,category:1,productImages:1,price:1,"reviews.averageReviewScore":1,"reviews.numberOfReviews":1,score:{$meta:"searchScore"},highlights:{$meta:"searchHighlights"}}},{$match:{$or:[{score:{$lt:this.lastScore}},{$and:[{score:{$eq:this.lastScore}},{productID:{$lt:this.lastProductID}}]}]}},{$sort:{score:-1,productID:-1}},{$limit:20}]).toArray().then(function(e){if(e.length>0){t.lastProductID=e[e.length-1].productID,t.lastScore=e[e.length-1].score,e.forEach(function(e){t.products.push(e)}),t.status=null;var s=t;setTimeout(function(){s.bouncable=!0},500)}else t.status={state:"success",text:"No more matching products",time:2e3}},function(e){t.status={state:"error",text:"Error: Failed to read the list of products – ".concat(e)}})},scroll:function(){var t=this;window.onscroll=function(){var e=750+Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)+window.innerHeight,s=document.documentElement.offsetHeight;e>=s&&t.bouncable&&(""===t.localSearchTerm?t.fetchProductList():t.searchProducts())}}},created:function(){this.localSearchTerm=this.searchTerm},mounted:function(){this.fetchProductList(),this.scroll()}},ft=pt,ht=(s("e87d"),Object(m["a"])(ft,J,X,!1,null,"abbe904e",null)),vt=ht.exports,gt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.saleCategoryTree?s("div",[s("CategoryNode",{attrs:{nodes:t.saleCategoryTree.children,name:t.saleCategoryTree.name,count:t.saleCategoryTree.count,depth:0,path:[]}})],1):t._e(),t.categoryTree?s("div",[s("CategoryNode",{attrs:{nodes:t.categoryTree.children,name:t.categoryTree.name,count:t.categoryTree.count,depth:0,path:[]},on:{"set-category-filter":t.setCategoryFilter}})],1):t._e(),s("Status",{attrs:{status:t.status}})],1)},Ct=[],bt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"category-menu"},[s("div",{style:t.indent,on:{click:t.categoryClicked}},[s("div",{staticClass:"control"},[s("a",{staticClass:"button is-not-outlined"},[s("span",{staticClass:"icon"},[t.nodes.length>0?s("i",{class:t.iconClasses}):t._e()]),s("span",[t._v(t._s(t.name)+" ")]),t.count?s("span",[s("small",[t._v("  ("+t._s(t.count)+")")])]):t._e()])])]),t.showChildren?s("div",t._l(t.nodes,function(e){return s("CategoryNode",{key:e.name,attrs:{name:e.name,count:e.count,nodes:e.children,depth:t.depth+1,path:t.newPath},on:{"set-category-filter":t.setCategoryFilter}})}),1):t._e()])])},yt=[],_t=s("75fc");function wt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function Ot(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?wt(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):wt(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var kt={name:"CategoryNode",props:["nodes","name","count","depth","path"],components:{},data:function(){return{showChildren:!1}},computed:{indent:function(){return{transform:"translate(".concat(10*this.depth,"px)")}},iconClasses:function(){return{"far fa-plus-square":!this.showChildren,"far fa-minus-square":this.showChildren}},newPath:function(){var t=Object(_t["a"])(this.path);return this.depth>0&&t.push(this.name),t}},methods:Ot({},Object(o["c"])(["setCategoryFilter"]),{categoryClicked:function(){this.showChildren=!this.showChildren,this.$emit("set-category-filter",this.newPath)}})},Pt=kt,jt=(s("e77f"),Object(m["a"])(Pt,bt,yt,!1,null,"996a760a",null)),$t=jt.exports;function xt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function St(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?xt(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):xt(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var It={name:"CategoryMenu",components:{CategoryNode:$t,Status:S},data:function(){return{status:null,categoryTree:null,saleCategoryTree:null}},methods:St({},Object(o["c"])(["setCategoryFilter"]),{fetchTree:function(){var t=this;this.categoryTree||(this.status={state:"progress",text:"Fetching product categories"},this.$root.$data.database.collection("meta").findOne({name:"categoryTree"}).then(function(e){t.status=null,e&&e.children&&(e=e.children[0]),t.categoryTree=e},function(e){t.status={state:"error",text:"Failed to fetch the product categories: ".concat(e)}}))},fetchSaleTree:function(){var t=this;this.saleCategoryTree||this.$root.$data.database.collection("meta").findOne({name:"saleCategoryTree"}).then(function(e){e&&e.children&&(e=e.children[0]),t.saleCategoryTree=e},function(e){t.status={state:"error",text:"Failed to fetch the sales product categories: ".concat(e)}})}}),mounted:function(){this.fetchTree(),this.fetchSaleTree()}},Dt=It,Et=Object(m["a"])(Dt,gt,Ct,!1,null,null,null),Rt=Et.exports,Bt={name:"home",components:{MyHeader:G,ProductCards:vt,CategoryMenu:Rt},data:function(){return{path:[],stitchReady:!1,windowWidth:100,searchTerm:""}},methods:{waitUntilStitchReady:function(){if(this.$root.$data.stitchClient&&this.$root.$data.stitchClient.auth.isLoggedIn)this.stitchReady=!0;else{var t=this;Object(P["setTimeout"])(t.waitUntilStitchReady,100)}},search:function(t){this.searchTerm=t},handleResize:function(){this.windowWidth=window.innerWidth}},created:function(){window.addEventListener("resize",this.handleResize),this.handleResize()},mounted:function(){this.waitUntilStitchReady()},destroyed:function(){window.removeEventListener("resize",this.handleResize)}},Tt=Bt,At=(s("47d6"),Object(m["a"])(Tt,v,g,!1,null,"3cb13f86",null)),Ft=At.exports,Lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"confirm-email"},[s("MyHeader"),s("ConfirmStitchEmail")],1)},Nt=[],Mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("h1",{staticClass:"title is-1"},[t._v("Confirming email address")]),s("Status",{attrs:{status:t.status}}),t.cta?s("div",{staticClass:"notification is-primary"},[s("div",{staticClass:"content"},[t._v("\n                "+t._s(t.cta)+"                \n            ")])]):t._e()],1)},Ut=[],qt=(s("386d"),{name:"ConfirmStitchEmail",components:{Status:S},data:function(){return{status:null,cta:""}},created:function(){var t,e=this,s="";try{var a=window.location.search,r=new URLSearchParams(a);t=r.get("token"),s=r.get("tokenId")}catch(n){this.status={state:"error",text:"Failed to parse URL parameters: ".concat(n)}}try{var i=this.$root.$data.stitchClient.auth.getProviderClient(I["d"].factory);i.confirmUser(t,s).then(function(){e.status={state:"success",text:"Password confirmed."},e.cta='Return to <router-link to="/">Home page</router-link> and login to continue.'},function(t){e.status={state:"error",text:"Failed to confirm email address: ".concat(t)}})}catch(n){this.status={state:"error",text:"Failed to confirm email address: ".concat(n)}}}}),Ht=qt,Wt=Object(m["a"])(Ht,Mt,Ut,!1,null,null,null),zt=Wt.exports,Vt={name:"confirm",components:{ConfirmStitchEmail:zt,MyHeader:G}},Qt=Vt,Kt=Object(m["a"])(Qt,Lt,Nt,!1,null,null,null),Yt=Kt.exports,Gt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"register"},[s("MyHeader"),s("div",{staticClass:"section"},[s("h1",{staticClass:"title is-2"},[t._v("Register new user")]),s("div",{staticClass:"field is-horizontal"},[t._m(0),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],staticClass:"input",attrs:{type:"email",placeholder:"Email"},domProps:{value:t.email},on:{input:function(e){e.target.composing||(t.email=e.target.value)}}}),t._m(1)])])])]),s("div",{staticClass:"field is-horizontal"},[t._m(2),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field is-expanded"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"input",attrs:{type:"password",placeholder:"Password"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._m(3)])])]),s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.password2,expression:"password2"}],staticClass:"input",attrs:{type:"password",placeholder:"Repeat password"},domProps:{value:t.password2},on:{input:function(e){e.target.composing||(t.password2=e.target.value)}}}),t._m(4)])])])]),s("div",{staticClass:"field is-grouped is-grouped-centered"},[s("p",{staticClass:"control"},[s("button",{staticClass:"button is-success",on:{click:t.register}},[t._v("\n                    Register\n                ")])])]),s("Status",{attrs:{status:t.status}})],1)],1)},Jt=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"},[t._v("ID")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-envelope"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"},[t._v("Password")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-key"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-key"})])}],Xt={name:"register",components:{MyHeader:G,Status:S},data:function(){return{status:null,email:"",password:"",password2:""}},methods:{register:function(){var t=this;if(this.status=null,this.password!=this.password2)this.status={state:"error",text:"Error, passwords must match."};else{this.status={state:"progress",text:"Registering ".concat(this.email)};var e=this.$root.$data.stitchClient.auth.getProviderClient(I["d"].factory);e.registerWithEmail(this.email,this.password).then(function(){t.status={state:"success",text:"Registration complete"};var e=t;setTimeout(function(){e.$router.push({name:"home"})},1e3)},function(e){t.status={state:"error",text:"Could not register user: ".concat(e.message)}})}}}},Zt=Xt,te=Object(m["a"])(Zt,Gt,Jt,!1,null,null,null),ee=te.exports,se=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"user-account"},[s("MyHeader"),t.stitchReady?s("div",{staticClass:"section"},[s("h1",{staticClass:"title is-3"},[t._v(t._s(t.userFirstName)+"'s Account")]),s("div",{staticClass:"tabs is-toggle is-toggle-rounded is-fullwidth"},[s("ul",[s("li",{class:{"is-active":t.profileTab},on:{click:t.pickProfile}},[t._m(0)]),s("li",{class:{"is-active":t.ordersTab},on:{click:t.pickOrders}},[t._m(1)]),s("li",{class:{"is-active":t.watchingTab},on:{click:t.pickWatching}},[t._m(2)])])]),t.profileTab?s("div",[s("UserProfile")],1):t._e(),t.ordersTab?s("div",[s("OrderCards")],1):t._e(),t.watchingTab?s("div",[s("WatchingCards")],1):t._e()]):t._e()],1)},ae=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("a",[s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-id-card"})]),s("span",[t._v("User Profile")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("a",[s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-truck"})]),s("span",[t._v("Orders")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("a",[s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-eye"})]),s("span",[t._v("Watching")])])}],re=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("div",{staticClass:"field is-horizontal"},[t._m(0),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.name.first,expression:"localCustomer.name.first"}],staticClass:"input",attrs:{type:"name",placeholder:"First"},domProps:{value:t.localCustomer.name.first},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.name,"first",e.target.value)}}}),t._m(1)])]),s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.name.last,expression:"localCustomer.name.last"}],staticClass:"input",attrs:{type:"name",placeholder:"Last"},domProps:{value:t.localCustomer.name.last},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.name,"last",e.target.value)}}}),t._m(2)])])])]),s("div",{staticClass:"field is-horizontal"},[t._m(3),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field is-expanded"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.phone.mobile,expression:"localCustomer.contact.phone.mobile"}],staticClass:"input",attrs:{type:"tel",placeholder:"Mobile phone number"},domProps:{value:t.localCustomer.contact.phone.mobile},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact.phone,"mobile",e.target.value)}}}),t._m(4)])]),s("p",{staticClass:"help"},[t._v("Include +CC")])]),s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.phone.home,expression:"localCustomer.contact.phone.home"}],staticClass:"input",attrs:{type:"tel",placeholder:"Home phone number"},domProps:{value:t.localCustomer.contact.phone.home},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact.phone,"home",e.target.value)}}}),t._m(5)]),s("p",{staticClass:"help"},[t._v("Include +CC")])])])]),s("div",{staticClass:"field is-horizontal"},[t._m(6),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field is-expanded"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.phone.work,expression:"localCustomer.contact.phone.work"}],staticClass:"input",attrs:{type:"tel",placeholder:"Work phone number"},domProps:{value:t.localCustomer.contact.phone.work},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact.phone,"work",e.target.value)}}}),t._m(7)])]),s("p",{staticClass:"help"},[t._v("Include +CC")])]),s("div",{staticClass:"field is-expanded"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.email,expression:"localCustomer.contact.email"}],staticClass:"input",attrs:{type:"email",placeholder:"Email",disabled:t.localCustomer.contact.email},domProps:{value:t.localCustomer.contact.email},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact,"email",e.target.value)}}}),t._m(8)])])])]),s("div",{staticClass:"field is-horizontal"},[t._m(9),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.deliveryAddress.number,expression:"localCustomer.contact.deliveryAddress.number"}],staticClass:"input",attrs:{type:"text",placeholder:"House name or number"},domProps:{value:t.localCustomer.contact.deliveryAddress.number},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact.deliveryAddress,"number",e.target.value)}}}),t._m(10)])]),s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.deliveryAddress.street,expression:"localCustomer.contact.deliveryAddress.street"}],staticClass:"input",attrs:{type:"text",placeholder:"Street name"},domProps:{value:t.localCustomer.contact.deliveryAddress.street},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact.deliveryAddress,"street",e.target.value)}}}),t._m(11)])])])]),s("div",{staticClass:"field is-horizontal"},[t._m(12),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.deliveryAddress.city,expression:"localCustomer.contact.deliveryAddress.city"}],staticClass:"input",attrs:{type:"text",placeholder:"Town or city"},domProps:{value:t.localCustomer.contact.deliveryAddress.city},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact.deliveryAddress,"city",e.target.value)}}}),t._m(13)])]),s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.deliveryAddress.state,expression:"localCustomer.contact.deliveryAddress.state"}],staticClass:"input",attrs:{type:"text",placeholder:"State"},domProps:{value:t.localCustomer.contact.deliveryAddress.state},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact.deliveryAddress,"state",e.target.value)}}}),t._m(14)])])])]),s("div",{staticClass:"field is-horizontal"},[t._m(15),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.deliveryAddress.postalCode,expression:"localCustomer.contact.deliveryAddress.postalCode"}],staticClass:"input",attrs:{type:"text",placeholder:"Postal code"},domProps:{value:t.localCustomer.contact.deliveryAddress.postalCode},on:{input:function(e){e.target.composing||t.$set(t.localCustomer.contact.deliveryAddress,"postalCode",e.target.value)}}}),t._m(16)])]),s("div",{staticClass:"field"},[s("div",{staticClass:"control is-expanded has-icons-left"},[s("div",{staticClass:"select"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.contact.deliveryAddress.country,expression:"localCustomer.contact.deliveryAddress.country"}],staticClass:"input",attrs:{type:"text",placeholder:"Country"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.localCustomer.contact.deliveryAddress,"country",e.target.multiple?s:s[0])}}},[s("option",{attrs:{selected:"",value:""}},[t._v("Country")]),t._l(t.countries,function(e){return s("option",{key:e.name},[t._v(t._s(e.name)+"\n                                ")])})],2)]),t._m(17)])])])]),s("div",{staticClass:"field is-horizontal"},[t._m(18),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("label",{staticClass:"checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.marketingPreferences.email,expression:"localCustomer.marketingPreferences.email"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.localCustomer.marketingPreferences.email)?t._i(t.localCustomer.marketingPreferences.email,null)>-1:t.localCustomer.marketingPreferences.email},on:{change:function(e){var s=t.localCustomer.marketingPreferences.email,a=e.target,r=!!a.checked;if(Array.isArray(s)){var i=null,n=t._i(s,i);a.checked?n<0&&t.$set(t.localCustomer.marketingPreferences,"email",s.concat([i])):n>-1&&t.$set(t.localCustomer.marketingPreferences,"email",s.slice(0,n).concat(s.slice(n+1)))}else t.$set(t.localCustomer.marketingPreferences,"email",r)}}}),t._v("\n                        I agree to receive notifications by email\n                    ")])]),s("div",{staticClass:"field"},[s("label",{staticClass:"checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.marketingPreferences.sms,expression:"localCustomer.marketingPreferences.sms"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.localCustomer.marketingPreferences.sms)?t._i(t.localCustomer.marketingPreferences.sms,null)>-1:t.localCustomer.marketingPreferences.sms},on:{change:function(e){var s=t.localCustomer.marketingPreferences.sms,a=e.target,r=!!a.checked;if(Array.isArray(s)){var i=null,n=t._i(s,i);a.checked?n<0&&t.$set(t.localCustomer.marketingPreferences,"sms",s.concat([i])):n>-1&&t.$set(t.localCustomer.marketingPreferences,"sms",s.slice(0,n).concat(s.slice(n+1)))}else t.$set(t.localCustomer.marketingPreferences,"sms",r)}}}),t._v("\n                        I agree to receive notifications by SMS text message\n                    ")])])])]),s("div",{staticClass:"field is-horizontal"},[t._m(19),s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("div",{staticClass:"file has-name"},[s("label",{staticClass:"file-label"},[s("input",{staticClass:"file-input",attrs:{type:"file",name:"resume"},on:{change:t.uploadMugshot}}),t._m(20),s("span",{staticClass:"file-name"},[t._v("\n                                "+t._s(t.mugshotFile.name)+"\n                            ")])])])]),s("div",{staticClass:"field"},[s("p",{staticClass:"control is-expanded has-icons-left"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.localCustomer.mugshotURL,expression:"localCustomer.mugshotURL"}],staticClass:"input",attrs:{type:"url",placeholder:"Mugshot image URL"},domProps:{value:t.localCustomer.mugshotURL},on:{input:function(e){e.target.composing||t.$set(t.localCustomer,"mugshotURL",e.target.value)}}}),t._m(21)])]),t.localCustomer.mugshotURL?s("div",{staticClass:"field"},[s("figure",{staticClass:"image is-128x128"},[s("img",{attrs:{src:t.localCustomer.mugshotURL}})])]):t._e()])]),s("div",{staticClass:"field is-grouped is-grouped-centered"},[s("p",{staticClass:"control"},[t.allowSubmit?s("button",{staticClass:"button is-success",on:{click:t.saveProfile}},[t._v("\n                    Save Profile\n                ")]):s("button",{staticClass:"button is-grey",attrs:{disbaled:""}},[t._v("\n                    Save Profile\n                ")])])]),s("Status",{attrs:{status:t.status}})],1)},ie=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"},[t._v("Name")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-user"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-user"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"},[t._v("Contact")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-phone"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-phone"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-phone"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-envelope"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"},[t._v("Delivery address")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-home"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-road"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-building"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-map"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-map-pin"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-globe"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"},[t._v("Marketing preferences")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"field-label is-normal"},[s("label",{staticClass:"label"},[t._v("Headshot")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"file-cta"},[s("span",{staticClass:"file-icon"},[s("i",{staticClass:"fas fa-upload"})]),s("span",{staticClass:"file-label"},[t._v("\n                                Upload a mugshot image…\n                            ")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small is-left"},[s("i",{staticClass:"fas fa-link"})])}],ne=(s("a481"),s("34ef"),s("7c53")),oe=s("9e8e");function ce(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function le(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?ce(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ce(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var ue={name:"user-profile",components:{Status:S},data:function(){return{status:null,localCustomer:{},countries:[],mugshotFile:{},allowSubmit:!0}},computed:le({},Object(o["d"])(["userLoggedIn","userFirstName","customer"])),methods:le({},Object(o["c"])(["setCustomer","setUserFirstName"]),{getCountriesList:function(){var t=this;this.$root.$data.stitchClient.callFunction("getCountriesList").then(function(e){t.countries=e},function(e){t.status={state:"error",text:"Error: failed to fetch country list: ".concat(e)}})},fetchCustomer:function(){var t=this;this.status={state:"progress",text:"Looking for existing user profile."},this.$root.$data.database.collection("customers").findOne({"contact.email":this.customer.contact.email}).then(function(e){e?(t.localCustomer=e,t.status=null):(t.localCustomer.contact.phone={home:"",work:"",mobile:""},t.localCustomer.deliveryAddress={number:"",street:"",city:"",state:"",postalCode:"",country:""},t.localCustomer.mugshotURL="",t.status=null)},function(e){t.status={state:"error",text:"Error: attempt to read customer document failed: ".concat(e)}})},saveProfile:function(){var t=this;this.status={state:"progress",text:"Writing profile to database."},this.$root.$data.database.collection("customers").updateOne({"contact.email":this.localCustomer.contact.email},this.localCustomer,{upsert:!0}).then(function(){t.status=null,t.setCustomer(t.localCustomer),t.localCustomer.name.first&&t.setUserFirstName(t.localCustomer.name.first),t.status={state:"success",text:"User profile updated.",time:1e3}},function(e){t.status={state:"error",text:"Error: Writing profile to the database - ".concat(e)}})},convertImageToBSON:function(t){return new Promise(function(e){var s=new FileReader;s.onload=function(t){var s=new oe["b"].Binary(new Uint8Array(t.target.result));e(s)},s.readAsArrayBuffer(t)})},uploadMugshot:function(t){var e=this;this.status=null;var s=t.target.files||t.dataTransfer.files;if(s.length){this.status={state:"progress",text:"Uploading image"},this.allowSubmit=!1,this.mugshotFile=s[0];var a=this.$root.$data.stitchClient.getServiceClient(ne["b"].factory,l.a.aws.serviceName),r=this.customer.contact.email.replace("+","_");this.convertImageToBSON(this.mugshotFile).then(function(t){var s=Date.now(),i={ACL:"public-read",Bucket:l.a.aws.bucket,ContentType:e.mugshotFile.type,Key:"mug_".concat(r,"_").concat(s),Body:t},n=(new ne["a"].Builder).withService("s3").withAction("PutObject").withArgs(i);a.execute(n.build()).then(function(){e.status=null,e.localCustomer.mugshotURL="https://".concat(l.a.aws.bucket,".s3.amazonaws.com/mug_").concat(r,"_").concat(s),e.allowSubmit=!0},function(t){e.status={state:"error",text:"Failed to upload image file: ".concat(t)}})},function(t){e.status={state:"error",text:"Error: Failed to convert image file: ".concat(t)},e.allowSubmit=!0})}else this.status={state:"error",text:"Failed to select a file"},this.allowSubmit=!0}}),created:function(){this.getCountriesList(),this.userLoggedIn?(this.localCustomer=this.customer,this.localCustomer.owner_id=this.$root.$data.stitchClient.auth.user.id,this.localCustomer.contact.email=this.customer.contact.email,this.fetchCustomer(),this.originalEmail=this.localCustomer.contact.email):this.status={state:"error",text:"Cannot access customer profile until user is logged in"}}},de=ue,me=Object(m["a"])(de,re,ie,!1,null,null,null),pe=me.exports,fe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("section",{staticClass:"section",attrs:{id:"order-cards"}},[t.customer.orders.length>0?s("div",[s("ul",{attrs:{id:"order-list"}},t._l(t.customer.orders,function(t){return s("li",{key:t.orderId},[s("OrderCard",{attrs:{order:t}})],1)}),0)]):s("div",[s("h3",{staticClass:"title is-4"},[t._v("No orders submitted yet")])])]),s("br")])},he=[],ve=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"box"},[s("article",{staticClass:"media"},[s("div",{staticClass:"media-left"},[s("figure",{staticClass:"image is-64x64"},[s("img",{attrs:{src:t.order.items[0].productImage}})])]),s("div",{staticClass:"media-content"},[s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-10"},[s("h6",{staticClass:"title is-6"},[t._v(t._s(t.order.orderID))]),s("p",[t._v("\n                                "+t._s(t.order.items.length)+" \n                                "),1===t.order.items.length?s("span",[t._v("item")]):s("span",[t._v("items")])]),s("p",[t._v("\n                                Ordered: "+t._s(t.order.orderDate)+"\n                            ")]),s("p",[t._v("\n                                Order status: "+t._s(t.order.status)+"\n                            ")])]),s("div",{staticClass:"column is-2"},[s("strong",[t._v("$"+t._s(t.order.totalPrice.toFixed(2)))])])]),s("nav",{staticClass:"level is-mobile"},["shipped"!=t.order.status&&"completed"!=t.order.status?s("div",{staticClass:"level-left"},[s("a",{staticClass:"level-item",attrs:{"aria-label":"trash"},on:{click:t.removeOrder}},[t._m(0)])]):t._e()]),s("Status",{attrs:{status:t.status}})],1)])])])},ge=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-trash",attrs:{"aria-hidden":"true"}})])}];function Ce(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function be(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?Ce(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Ce(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var ye={name:"OrderCard",props:["order"],components:{Status:S},data:function(){return{status:null}},methods:be({},Object(o["b"])(["deleteOrder"]),{removeOrder:function(){var t=this;this.status={state:"progress",text:"Deleting order"},this.deleteOrder({database:this.$root.$data.database,stitchClient:this.$root.$data.stitchClient,orderID:this.order.orderID}).then(function(){t.status={state:"success",text:"Order deleted",time:2e3}},function(e){t.status={state:"error",text:"Failed to delete the order: ".concat(e)}})}})},_e=ye,we=(s("7db8"),Object(m["a"])(_e,ve,ge,!1,null,"0bb5336a",null)),Oe=we.exports;function ke(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function Pe(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?ke(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ke(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var je={name:"OrderCards",props:[],components:{OrderCard:Oe},computed:Pe({},Object(o["d"])(["customer"]))},$e=je,xe=(s("912c"),Object(m["a"])($e,fe,he,!1,null,"e53dd2c4",null)),Se=xe.exports,Ie=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("section",{staticClass:"section",attrs:{id:"watching-cards"}},[t.customer.waitingOnProducts.length>0?s("div",[s("ul",{attrs:{id:"watch-list"}},t._l(t.customer.waitingOnProducts,function(t){return s("li",{key:t},[s("WatchingCard",{attrs:{productID:t}})],1)}),0)]):s("div",[s("h3",{staticClass:"title is-4"},[t._v("Not currently watching any products")])])]),s("br")])},De=[],Ee=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.product?s("div",{staticClass:"box"},[s("article",{staticClass:"media"},[s("div",{staticClass:"media-left"},[s("figure",{staticClass:"image is-64x64"},[s("img",{attrs:{src:t.product.productImages[0]}})])]),s("div",{staticClass:"media-content"},[s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-10"},[s("h6",{staticClass:"title is-6"},[t._v(t._s(t.product.productName))])]),s("div",{staticClass:"column is-2"},[s("strong",[t._v("$"+t._s(t.product.price.sale))])])]),s("nav",{staticClass:"level is-mobile"},[s("div",{staticClass:"level-left"},[s("a",{staticClass:"level-item",attrs:{"aria-label":"unwatch"},on:{click:t.stopWatching}},[t._m(0)])])]),s("Status",{attrs:{status:t.status}})],1)])]):t._e()])},Re=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-eye-slash",attrs:{"aria-hidden":"true"}})])}];function Be(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function Te(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?Be(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Be(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var Ae={name:"watchingCard",components:{Status:S},props:["productID"],data:function(){return{status:null,product:null}},methods:Te({},Object(o["b"])(["unWatch"]),{stopWatching:function(){var t=this;this.status={state:"progress",text:"Unwatching product"},this.unWatch({database:this.$root.$data.database,productID:this.productID}).then(function(){t.status={state:"success",text:"Unwatched product",time:1e3},t.product=null})}}),mounted:function(){var t=this;this.status={state:"progress",text:"Fetching product"},this.$root.$data.database.collection("products").findOne({productID:this.productID}).then(function(e){t.product=e,t.status=null},function(e){t.status={state:"error",text:"Failed to fetch document for productID ".concat(t.productID,": ").concat(e)}})}},Fe=Ae,Le=(s("9f14"),Object(m["a"])(Fe,Ee,Re,!1,null,"5f28a166",null)),Ne=Le.exports;function Me(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function Ue(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?Me(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Me(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var qe={name:"WatchingCards",components:{WatchingCard:Ne},data:function(){return{status:null}},computed:Ue({},Object(o["d"])(["customer"]))},He=qe,We=(s("75ed"),Object(m["a"])(He,Ie,De,!1,null,"0ca7415c",null)),ze=We.exports;function Ve(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function Qe(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?Ve(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Ve(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var Ke={name:"account",props:[],components:{MyHeader:G,UserProfile:pe,OrderCards:Se,WatchingCards:ze},data:function(){return{profileTab:!0,ordersTab:!1,watchingTab:!1,stitchReady:!1}},computed:Qe({},Object(o["d"])(["userFirstName"])),methods:{pickProfile:function(){this.profileTab=!0,this.ordersTab=!1,this.watchingTab=!1},pickOrders:function(){this.profileTab=!1,this.ordersTab=!0,this.watchingTab=!1},pickWatching:function(){this.profileTab=!1,this.ordersTab=!1,this.watchingTab=!0},waitUntilStitchReady:function(){if(this.$root.$data.stitchClient&&this.$root.$data.stitchClient.auth.isLoggedIn)this.stitchReady=!0;else{var t=this;setTimeout(t.waitUntilStitchReady,100)}}},mounted:function(){this.waitUntilStitchReady()}},Ye=Ke,Ge=Object(m["a"])(Ye,se,ae,!1,null,null,null),Je=Ge.exports,Xe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home"},[s("MyHeader"),s("section",{staticClass:"section"},[t.stitchReady&&t.product?s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-5 "},[s("div",{staticClass:"container"},[s("ImageBox",{attrs:{productImages:t.product.productImages}})],1)]),s("div",{staticClass:"column is-4"},[s("div",{staticClass:"container"},[s("ProductSummary",{attrs:{productName:t.product.productName,category:t.product.category,categoryHierarchy:t.product.categoryHierarchy,price:t.product.price,averageReviewScore:t.product.reviews.averageReviewScore,numberOfReviews:t.product.reviews.numberOfReviews,productDescription:t.product.description}})],1)]),s("div",{staticClass:"column is-3"},[s("div",{staticClass:"container"},[s("PurchaseBox",{attrs:{stockLevel:t.product.stockLevel,productID:t.product.productID,productName:t.product.productName,price:t.product.price.sale,productImage:t.product.productImages[0]}})],1)])]):t._e(),t.stitchReady&&t.product?s("div",[s("ProductReviews",{attrs:{reviews:t.product.reviews,productID:t.product.productID},on:{reviewStats:t.newReviewStats}})],1):t._e()]),s("Status",{attrs:{status:t.status}})],1)},Ze=[],ts=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{},[s("section",{staticClass:"section"},[s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-2 restrict-height"},[s("ul",{attrs:{id:"product-images"}},t._l(t.productImages,function(e){return s("li",{key:e,on:{mouseover:function(s){t.currentImage=e}}},[s("a",[s("div",{staticClass:"box"},[s("figure",{staticClass:"image is-square"},[s("img",{attrs:{src:e}})])])])])}),0)]),s("div",{staticClass:"column is-10"},[t.currentImage?s("figure",{staticClass:"image is-square"},[s("img",{attrs:{src:t.currentImage,alt:""}})]):t._e()])])])])},es=[],ss={name:"image-box",props:["productImages"],data:function(){return{currentImage:null}},created:function(){this.productImages&&this.productImages.length>0&&(this.currentImage=this.productImages[0])}},as=ss,rs=(s("7e18"),Object(m["a"])(as,ts,es,!1,null,"7094bcb9",null)),is=rs.exports,ns=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{},[s("section",{staticClass:"section"},[s("h3",{staticClass:"title is-3"},[t._v(t._s(t.productName))]),t.category?s("span",{staticClass:"tag"},[t._v(t._s(t.category))]):t._e(),s("Rank",{attrs:{score:t.averageReviewScore,numberReviews:t.numberOfReviews}}),s("table",{staticClass:"table",attrs:{cellspacing:"0",id:"pricing"}},[s("tbody",[t.price.list?s("tr",[s("td",{staticClass:"right"},[t._v("List price:")]),s("td",[t._v("$"+t._s(t.price.list))])]):t._e(),s("tr",[s("td",{staticClass:"right last-child"},[t._v("Our price:")]),s("td",[s("strong",[t._v("$"+t._s(t.price.sale))]),t._v("  "),t.saleTag?s("span",{staticClass:"tag is-danger"},[t._v(t._s(t.saleTag))]):t._e()])]),t.saving>0?s("tr",[s("td",{staticClass:"right"},[t._v("You save:")]),s("td",[t._v("$"+t._s(t.saving)+" ("+t._s(t.savingPercent)+"%)")])]):t._e()])]),t.categoryHierarchy.length>2?s("nav",{staticClass:"breadcrumb has-arrow-separator",attrs:{"aria-label":"breadcrumbs"}},[s("ul",{attrs:{id:"category-breadcrumbs"}},t._l(t.categoryHierarchy.slice(1,t.categoryHierarchy.length),function(e){return s("li",{key:e},[s("span",{staticClass:"tag"},[t._v(t._s(e))])])}),0)]):t._e(),s("div",{staticClass:"content",attrs:{id:"product-description"}},[t._v("\n      "+t._s(t.productDescription)+"\n    ")])],1)])},os=[],cs=(s("6762"),s("2fdb"),{name:"product-summary",props:["productName","category","categoryHierarchy","price","averageReviewScore","numberOfReviews","productDescription"],components:{Rank:nt},data:function(){return{saving:0,savingPercent:0,saleTag:null}},methods:{calculateSaving:function(){this.price&&this.price.sale>0&&this.price.list>0&&(this.saving=(this.price.list-this.price.sale).toFixed(2),this.savingPercent=(100*((this.price.list-this.price.sale)/this.price.list).toFixed(2)).toFixed(0),this.categoryHierarchy.includes("sale")&&(this.saleTag="sale"))}},mounted:function(){this.calculateSaving()}}),ls=cs,us=(s("1ab2"),Object(m["a"])(ls,ns,os,!1,null,"976d1ab4",null)),ds=us.exports,ms=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("section",{staticClass:"section"},[t.stockLevel>0?s("div",[s("p",[s("span",{staticClass:"has-text-primary"},[t._v(t._s(t.stockLevel)+" units in stock")])]),s("div",{staticClass:"field"},[s("div",{staticClass:"field-body"},[s("div",{staticClass:"field"},[s("label",[t._v("\n                          Quantity: \n                          "),s("div",{staticClass:"select is-small"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.quantity,expression:"quantity"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.quantity=e.target.multiple?s:s[0]}}},t._l(Math.min(20,t.stockLevel),function(e){return s("option",{key:e},[t._v("\n                                  "+t._s(e)+"\n                              ")])}),0)])])])])]),s("div",[s("p",[t._v("\n              $"+t._s((t.quantity*t.price).toFixed(2))+"\n              "),s("br")])]),s("div",{staticClass:"buttons are-small"},[s("p",[t.quantity>0?s("a",{staticClass:"button is-primary is-small is-focused",on:{click:t.newBasketItem}},[t._m(0),s("span",[t._v("Add to basket")])]):s("a",{staticClass:"button is-grey is-small",attrs:{disabled:""}},[t._m(1),s("span",[t._v("Add to basket")])])])])]):s("div",{staticClass:"field"},[t._m(2),s("label",{staticClass:"checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.notifyMe,expression:"notifyMe"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.notifyMe)?t._i(t.notifyMe,null)>-1:t.notifyMe},on:{change:[function(e){var s=t.notifyMe,a=e.target,r=!!a.checked;if(Array.isArray(s)){var i=null,n=t._i(s,i);a.checked?n<0&&(t.notifyMe=s.concat([i])):n>-1&&(t.notifyMe=s.slice(0,n).concat(s.slice(n+1)))}else t.notifyMe=r},t.notificationChange]}}),t._v("\n            Notify me when back in stock\n        ")])]),s("Status",{attrs:{status:t.status}})],1)])},ps=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-cart-plus"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-cart-plus"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("span",{staticClass:"has-text-danger"},[t._v("\n            Product is out of stock\n          ")])])}];function fs(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function hs(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?fs(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):fs(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var vs={name:"purchase-box",components:{Status:S},props:["stockLevel","productID","productName","price","productImage"],data:function(){return{status:null,notifyMe:!1,quantity:0}},computed:hs({},Object(o["d"])(["customer","userLoggedIn"])),methods:hs({},Object(o["c"])(["setWaitingOnProducts"]),{},Object(o["b"])(["addToBasket"]),{notificationChange:function(){var t=this;if(this.userLoggedIn){if(this.customer.waitingOnProducts||(this.customer.waitingOnProducts=[]),this.notifyMe&&!this.customer.waitingOnProducts.includes(this.productID))this.customer.waitingOnProducts.push(this.productID);else if(!this.notifyMe&&this.customer.waitingOnProducts.includes(this.productID)){var e=this.customer.waitingOnProducts.indexOf(this.productID);this.customer.waitingOnProducts.splice(e,1)}this.status={state:"progress",text:"Updating customer"},this.$root.$data.database.collection("customers").updateOne({"contact.email":this.customer.contact.email},{$set:{waitingOnProducts:this.customer.waitingOnProducts}}).then(function(){t.setWaitingOnProducts(t.customer.waitingOnProducts),t.status={state:"success",text:"Customer document updated",time:2e3}},function(e){t.status={state:"error",text:"Failed to update the customer document: ".concat(e)},t.notifyMe=!t.notifyMe})}else this.status={state:"error",text:"You must log in first",time:2e3},this.notifyMe=!1},newBasketItem:function(){var t=parseInt(this.quantity);this.quantity=0,this.addToBasket({database:this.$root.$data.database,itemArray:[{productID:this.productID,productName:this.productName,price:this.price,productImage:this.productImage,quantity:t}]})}}),mounted:function(){this.notifyMe=this.customer.waitingOnProducts&&this.customer.waitingOnProducts.includes(this.productID)}},gs=vs,Cs=(s("2d6e"),Object(m["a"])(gs,ms,ps,!1,null,"1f7de3c2",null)),bs=Cs.exports,ys=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("section",{staticClass:"section"},[s("h3",{staticClass:"title is-3"},[t._v("Reviews")]),t.showReviewForm||t.reviewSubmited?t._e():s("a",{staticClass:"button is-success",on:{click:t.exposeReviewForm,reviewPosted:t.postedReview}},[t._m(0),s("span",[t._v("Post Review")])]),t.showReviewForm?s("AddReview",{attrs:{productID:t.productID},on:{reviewStats:t.newReviewStats,review:t.newReview}}):t._e(),s("br"),s("br"),s("ul",{attrs:{id:"review-list"}},t._l(t.reviews.recentReviews,function(e){return s("li",{key:e.review},[s("div",{staticClass:"box"},[t._v("\n              "+t._s(e.review)+" "),s("br"),s("br"),s("div",{staticClass:"level-left"},t._l([1,2,3,4,5],function(t){return s("a",{key:t,staticClass:"level-item"},[e.score>=t?s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"fas fa-star"})]):s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"far fa-star"})])])}),0)])])}),0),s("ArchivedReviews",{attrs:{productID:t.productID}})],1)])},_s=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon"},[s("i",{staticClass:"far fa-comment-dots"})])}],ws=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",attrs:{id:"add-review"}},[t.userLoggedIn?s("div",{staticClass:"notification"},[s("h1",{staticClass:"title is-2"},[t._v("Review this product")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],staticClass:"textarea",attrs:{id:"comment",placeholder:"Tell us what you think about this product"},domProps:{value:t.comment},on:{input:function(e){e.target.composing||(t.comment=e.target.value)}}}),s("br"),s("div",{staticClass:"box"},[s("div",{staticClass:"level-left"},[s("span",{on:{click:function(e){return t.setStars(1)}}},[t.stars>=1?s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"fas fa-star"})]):s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"far fa-star"})])]),s("span",{on:{click:function(e){return t.setStars(2)}}},[t.stars>=2?s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"fas fa-star"})]):s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"far fa-star"})])]),s("span",{on:{click:function(e){return t.setStars(3)}}},[t.stars>=3?s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"fas fa-star"})]):s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"far fa-star"})])]),s("span",{on:{click:function(e){return t.setStars(4)}}},[t.stars>=4?s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"fas fa-star"})]):s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"far fa-star"})])]),s("span",{on:{click:function(e){return t.setStars(5)}}},[t.stars>=5?s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"fas fa-star"})]):s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"far fa-star"})])])])]),s("div",{staticClass:"field is-grouped is-grouped-centered"},[s("p",{staticClass:"control"},[s("button",{staticClass:"button is-success is-medium is-focused",on:{click:t.postReview}},[t._m(0),s("span",[t._v("Post review")])])])])]):t._e(),s("Status",{attrs:{status:t.status}})],1)},Os=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"far fa-save"})])}],ks={name:"addReview",components:{Status:S},props:["productID","reviews"],data:function(){return{status:null,comment:"",stars:0}},methods:{setStars:function(t){this.stars=t},postReview:function(){var t=this;this.$root.$data.stitchClient.callFunction("addReview",[this.productID,this.comment,this.stars]).then(function(e){if(e&&e.averageReviewScore&&e.numberOfReviews){var s={averageReviewScore:e.averageReviewScore,numberOfReviews:e.numberOfReviews};t.$emit("reviewStats",s),t.$emit("review",{review:t.comment,score:t.stars})}},function(e){t.status={state:"error",text:"Error: failed to post review: ".concat(e)}})}}},Ps=ks,js=Object(m["a"])(Ps,ws,Os,!1,null,null,null),$s=js.exports,xs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("ul",{attrs:{id:"review-list"}},t._l(t.reviews,function(e){return s("li",{key:e.review},[s("div",{staticClass:"box"},[t._v("\n              "+t._s(e.review)+" "),s("br"),s("br"),s("div",{staticClass:"level-left"},t._l([1,2,3,4,5],function(t){return s("a",{key:t,staticClass:"level-item"},[e.score>=t?s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"fas fa-star"})]):s("span",{staticClass:"icon is-small has-text-warning"},[s("i",{staticClass:"far fa-star"})])])}),0)])])}),0),s("Status",{attrs:{status:t.status}})],1)},Ss=[],Is={name:"archived-reviews",props:["productID"],components:{Status:S},data:function(){return{status:null,reviews:[],lastId:null,bouncable:!0}},methods:{fetchReviews:function(){var t=this;this.status={state:"progress",text:"Fetching more reviews"},this.bouncable=!1;var e=null;e=this.lastId?{productID:this.productID,_id:{$lt:this.lastId}}:{productID:this.productID},this.$root.$data.database.collection("reviewOverflow").find(e,{sort:{_id:-1},limit:20}).toArray().then(function(e){if(e.length>0){t.lastId=e[e.length-1]._id,e.forEach(function(e){t.reviews.push(e)}),t.status=null;var s=t;setTimeout(function(){s.bouncable=!0},500)}else t.status=null},function(e){t.status={state:"error",text:"Error: Failed to read archived reviews – ".concat(e)}})},scroll:function(){var t=this;window.onscroll=function(){var e=750+Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)+window.innerHeight,s=document.documentElement.offsetHeight;e>=s&&t.bouncable&&t.fetchReviews()}}},mounted:function(){this.scroll()}},Ds=Is,Es=(s("e655"),Object(m["a"])(Ds,xs,Ss,!1,null,"00558e7b",null)),Rs=Es.exports,Bs={name:"product-reviews",props:["reviews","productID"],components:{AddReview:$s,ArchivedReviews:Rs},data:function(){return{showReviewForm:!1,reviewSubmited:!1}},methods:{exposeReviewForm:function(){this.showReviewForm=!0},postedReview:function(t){this.reviews.unshift(t),this.reviewSubmited=!0},newReviewStats:function(t){this.$emit("reviewStats",t)},newReview:function(t){this.reviews.recentReviews.unshift(t),this.showReviewForm=!1,this.reviewSubmited=!0}}},Ts=Bs,As=(s("5a57"),Object(m["a"])(Ts,ys,_s,!1,null,"1d14b82c",null)),Fs=As.exports,Ls={name:"product",components:{MyHeader:G,Status:S,ImageBox:is,ProductSummary:ds,PurchaseBox:bs,ProductReviews:Fs},data:function(){return{status:null,stitchReady:!1,productID:null,product:null}},methods:{fetchProduct:function(){var t=this;this.productID?(this.status={state:"progress",text:"Fetching product details"},this.$root.$data.database.collection("products").findOne({productID:this.productID}).then(function(e){e?(t.status=null,t.product=e):t.status={state:"error",text:"No product found with productId ".concat(t.productID)}},function(e){t.status={state:"error",text:"Error: failed to read product data: ".concat(e.message)}})):this.status={state:"error",text:"Error, no productID included in URL query parameters"}},newReviewStats:function(t){this.product.reviews.averageReviewScore=t.averageReviewScore,this.product.reviews.numberOfReviews=t.numberOfReviews},waitUntilStitchReady:function(){if(this.$root.$data.stitchClient&&this.$root.$data.stitchClient.auth.isLoggedIn)this.stitchReady=!0,this.fetchProduct();else{var t=this;Object(P["setTimeout"])(t.waitUntilStitchReady,100)}}},mounted:function(){this.productID=this.$route.query.productID,this.waitUntilStitchReady()}},Ns=Ls,Ms=Object(m["a"])(Ns,Xe,Ze,!1,null,null,null),Us=Ms.exports,qs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"basket"},[s("MyHeader"),s("section",{staticClass:"section"},[t.stitchReady?s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-9 scroll",attrs:{id:"products"}},[s("div",{staticClass:"container"},[s("BasketCards")],1)]),s("div",{staticClass:"column is-3 restrict-height"},[s("div",{staticClass:"container"},[s("strong",[t._v("Basket Total: $"+t._s(t.metaCustomer.shoppingBasketValue.toFixed(2)))])]),s("div",{staticClass:"buttons"},[s("p",[t.metaCustomer.shoppingBasketSize>0?s("a",{staticClass:"button is-primary is-focused",on:{click:t.checkout}},[t._m(0),s("span",[t._v("Checkout")])]):s("a",{staticClass:"button is-grey",attrs:{disabled:""}},[t._m(1),s("span",[t._v("Checkout")])])])])])]):t._e()])],1)},Hs=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon"},[s("i",{staticClass:"fas fa-wallet"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon"},[s("i",{staticClass:"fas fa-wallet"})])}],Ws=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("section",{staticClass:"section",attrs:{id:"basket-cards"}},[s("ul",{attrs:{id:"basket-list"}},t._l(t.customer.shoppingBasket,function(t){return s("li",{key:t.productId},[s("BasketCard",{attrs:{product:t}})],1)}),0)])])},zs=[],Vs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"box"},[s("article",{staticClass:"media"},[s("div",{staticClass:"media-left"},[s("figure",{staticClass:"image is-64x64"},[s("img",{attrs:{src:t.product.productImage}})])]),s("div",{staticClass:"media-content"},[s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-8"},[s("h6",{staticClass:"title is-6"},[t._v(t._s(t.product.productName))])]),s("div",{staticClass:"column is-2"},[t._v("\n                            $"+t._s(t.product.price)+" each\n                        ")]),s("div",{staticClass:"column is-2"},[s("strong",[t._v("$"+t._s((t.product.price*t.product.quantity).toFixed(2)))]),t._v(" total\n                        ")])]),s("nav",{staticClass:"level is-mobile"},[s("div",{staticClass:"level-left"},[s("a",{staticClass:"level-item",attrs:{"aria-label":"trash"},on:{click:t.deleteItem}},[t._m(0)]),s("a",{staticClass:"level-item",attrs:{"aria-label":"minus"},on:{click:t.decrementItem}},[t._m(1)]),s("span",{staticClass:"iconNumber"},[t._v("\n                                    "+t._s(t.product.quantity)+"\n                                ")]),s("a",{staticClass:"level-item",attrs:{"aria-label":"plus"},on:{click:t.incrementItem}},[t._m(2)])])])])])])])},Qs=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-trash",attrs:{"aria-hidden":"true"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-minus-square",attrs:{"aria-hidden":"true"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon is-small"},[s("i",{staticClass:"fas fa-plus-square",attrs:{"aria-hidden":"true"}})])}];function Ks(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function Ys(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?Ks(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Ks(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var Gs={name:"BasketCard",props:["product"],data:function(){return{newQuantity:0}},methods:Ys({},Object(o["b"])(["deleteFromBasket","updateBasketItemQuantity"]),{deleteItem:function(){this.deleteFromBasket({database:this.$root.$data.database,productID:this.product.productID})},incrementItem:function(){this.updateBasketItemQuantity({database:this.$root.$data.database,productID:this.product.productID,quantity:this.product.quantity+1})},decrementItem:function(){this.product.quantity>0&&this.updateBasketItemQuantity({database:this.$root.$data.database,productID:this.product.productID,quantity:this.product.quantity-1})}}),mounted:function(){this.newQuantity=this.product.quantity}},Js=Gs,Xs=(s("a123"),Object(m["a"])(Js,Vs,Qs,!1,null,"c61ecb2c",null)),Zs=Xs.exports;function ta(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function ea(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?ta(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ta(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var sa={name:"BasketCards",components:{BasketCard:Zs},computed:ea({},Object(o["d"])(["customer"]))},aa=sa,ra=Object(m["a"])(aa,Ws,zs,!1,null,null,null),ia=ra.exports;function na(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function oa(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?na(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):na(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var ca={name:"basket",props:[],components:{MyHeader:G,BasketCards:ia},data:function(){return{path:[],stitchReady:!1}},computed:oa({},Object(o["d"])(["customer","metaCustomer"])),methods:{waitUntilStitchReady:function(){if(this.$root.$data.stitchClient&&this.$root.$data.stitchClient.auth.isLoggedIn)this.stitchReady=!0;else{var t=this;Object(P["setTimeout"])(t.waitUntilStitchReady,100)}},checkout:function(){this.$router.push({name:"checkout"})}},mounted:function(){this.waitUntilStitchReady()}},la=ca,ua=(s("a0ef"),Object(m["a"])(la,qs,Hs,!1,null,"32a3cc9c",null)),da=ua.exports,ma=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"checkout"},[s("MyHeader"),s("section",{staticClass:"section"},[t.stitchReady?s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-9 scroll",attrs:{id:"products"}},[s("div",{staticClass:"container"},[s("h3",{staticClass:"title is-4"},[t._v("Delivery Address")]),s("div",{staticClass:"columns container"},[t.customer.contact.deliveryAddress?s("div",{staticClass:"column is-9"},[t._v("\n                        "+t._s(t.customer.name.title)+" "+t._s(t.customer.name.first)+" "+t._s(t.customer.name.last)+"\n                        "),s("br"),t._v("\n                        "+t._s(t.customer.contact.deliveryAddress.number)+"\n                        "+t._s(t.customer.contact.deliveryAddress.street)+"\n                        "),s("br"),t._v("\n                        "+t._s(t.customer.contact.deliveryAddress.city)+"\n                        "),s("br"),t._v("\n                        "+t._s(t.customer.contact.deliveryAddress.state)+"\n                        "),s("br"),t._v("\n                        "+t._s(t.customer.contact.deliveryAddress.postalCode)+"\n                    ")]):s("div",{staticClass:"column is-9"},[s("h4",{staticClass:"title is-5"},[s("a",{on:{click:t.editAddress}},[t._v("\n                        Please provide address\n                      ")])])]),s("div",{staticClass:"column is-2"},[s("a",{staticClass:"button is-small",on:{click:t.editAddress}},[t._m(0),s("span",[t._v("Edit address")])])])]),s("h3",{staticClass:"title is-4"},[t._v("Payment method")]),s("div",{staticClass:"columns container"},[s("div",{staticClass:"column is-9"},t._l(t.paymentMethods,function(e){return s("div",{key:e.name},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.paymentMethod,expression:"paymentMethod"}],attrs:{type:"radio",name:"paymentMethod"},domProps:{value:e.name,checked:t._q(t.paymentMethod,e.name)},on:{change:function(s){t.paymentMethod=e.name}}}),t._v(" "+t._s(e.name)+"\n                    ")])}),0),s("div",{staticClass:"column is-2"},[s("a",{staticClass:"button is-small",on:{click:t.editAddress}},[t._m(1),s("span",[t._v("Payment options")])])])]),s("h3",{staticClass:"title is-4"},[t._v("Order items")]),s("BasketCards")],1)]),s("div",{staticClass:"column is-3 restrict-height"},[s("div",{staticClass:"container"},[s("strong",[t._v("Basket Total: $"+t._s(t.metaCustomer.shoppingBasketValue.toFixed(2)))])]),s("div",{staticClass:"buttons"},[s("p",[t.metaCustomer.shoppingBasketSize>0&&t.customer.contact.deliveryAddress?s("a",{staticClass:"button is-primary  is-focused",on:{click:t.checkout}},[t._m(2),s("span",[t._v("Pay now")])]):s("a",{staticClass:"button is-grey",attrs:{disabled:""}},[t._m(3),s("span",[t._v("Pay now")])])])])])]):t._e(),s("Status",{attrs:{status:t.status}})],1)],1)},pa=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon"},[s("i",{staticClass:"fas fa-edit"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon"},[s("i",{staticClass:"fas fa-edit"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon"},[s("i",{staticClass:"fas fa-wallet"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"icon"},[s("i",{staticClass:"fas fa-wallet"})])}],fa=s("bac6"),ha=s.n(fa);function va(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function ga(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?va(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):va(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var Ca={name:"checkout",components:{MyHeader:G,Status:S,BasketCards:ia},data:function(){return{status:null,stitchReady:!1,paymentMethods:[{name:"Scooby snacks"},{name:"Leafies"},{name:"Credit or debit card"}],paymentMethod:"Credit or debit card"}},computed:ga({},Object(o["d"])(["customer","metaCustomer"])),methods:ga({},Object(o["b"])(["emptyBasket","fetchOrders"]),{},Object(o["c"])(["setCheckoutID"]),{waitUntilStitchReady:function(){if(this.$root.$data.stitchClient&&this.$root.$data.stitchClient.auth.isLoggedIn)this.stitchReady=!0;else{var t=this;Object(P["setTimeout"])(t.waitUntilStitchReady,100)}},editAddress:function(){this.$router.push({name:"account"})},submitOrder:function(){var t=this;this.$root.$data.stitchClient.callFunction("placeOrder",[this.paymentMethod]).then(function(e){e&&e.result?(t.emptyBasket(t.$root.$data.database),t.fetchOrders(t.$root.$data.database).then(function(){t.status=null,t.$router.push({name:"home"})},function(e){t.status={state:"oror",text:"Failed to fetch list of orders: ".concat(e)}})):(t.status=null,e&&(t.status={state:"error",text:"Error, failed to submit order: ".concat(e.error)}))},function(e){t.status={state:"error",text:"Error: failed to submit order: ".concat(e)}})},checkout:function(){var t=this;this.status={state:"progress",text:"Submitting order"},"Credit or debit card"===this.paymentMethod?this.$root.$data.stitchClient.callFunction("stripeCreateCheckoutSession",[Math.round(100*this.metaCustomer.shoppingBasketValue)/100]).then(function(e){if(e){var s=ha()(l.a.stripePublicKey);s.redirectToCheckout({sessionId:e})}else t.status={state:"error",text:"Failed to process payment"}},function(e){t.status={state:"error",text:"Error, failed to create Stripe checkout session: ".concat(e)}}):this.submitOrder()}}),mounted:function(){this.waitUntilStitchReady()}},ba=Ca,ya=(s("e8ce"),Object(m["a"])(ba,ma,pa,!1,null,"eaf2b4a4",null)),_a=ya.exports,wa=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"checked-out"},[s("MyHeader"),t._m(0),s("div",{staticClass:"container"},[s("Status",{attrs:{status:t.status}})],1)],1)},Oa=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"section"},[s("div",{staticClass:"container"},[s("h3",{staticClass:"title is-3"},[t._v("Payment complete")])])])}];function ka(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function Pa(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?ka(s,!0).forEach(function(e){Object(y["a"])(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ka(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}var ja={name:"checkedout",props:[],components:{MyHeader:G,Status:S},data:function(){return{status:null}},methods:Pa({},Object(o["c"])(["clearBasket"]),{},Object(o["b"])(["fetchOrders","calcBasketStats"]),{updateBasketAndOrders:function(){var t=this;this.clearBasket(),this.calcBasketStats(),this.fetchOrders(this.$root.$data.database).then(function(){t.status={state:"progress",text:"Taking you back to the store..."};var e=t;Object(P["setTimeout"])(function(){e.$router.push({name:"home"})},2e3)},function(e){t.status={state:"error",text:"Failed to fetch your orders from the database: ".concat(e)}})},waitUntilStitchReady:function(){if(this.$root.$data.stitchClient&&this.$root.$data.stitchClient.auth.isLoggedIn)this.updateBasketAndOrders();else{var t=this;Object(P["setTimeout"])(t.waitUntilStitchReady,100)}}}),mounted:function(){this.waitUntilStitchReady()}},$a=ja,xa=Object(m["a"])($a,wa,Oa,!1,null,null,null),Sa=xa.exports;a["a"].use(h["a"]);var Ia=new h["a"]({routes:[{path:"/",name:"home",component:Ft,props:!0},{path:"/confirm",name:"confirm",component:Yt,props:!0},{path:"/register",name:"register",component:ee,props:!0},{path:"/account",name:"account",component:Je,props:!0},{path:"/product",name:"product",component:Us,props:!0},{path:"/basket",name:"basket",component:da,props:!0},{path:"/checkout",name:"checkout",component:_a,props:!0},{path:"/checkedout",name:"checkedout",component:Sa,props:!0}]}),Da=(s("92c6"),s("abe2"),s("0e44"));function Ea(t){l.a.logErrors&&console.error(t)}a["a"].config.productionTip=!1;var Ra={name:{title:"",first:"",last:""},contact:{email:"",phone:{home:"",work:"",mobile:""},deliveryAddress:{number:"",street:"",city:"",state:"",postalCode:"",country:""}},marketingPreferences:{email:!1,sms:!1},waitingOnProducts:[],shoppingBasket:[],orders:[],orderOverflow:!1},Ba={shoppingBasketSize:0,shoppingBasketValue:0},Ta=new o["a"].Store({plugins:[Object(Da["a"])()],state:{userLoggedIn:!1,userFirstName:"Guest",customer:Ra,metaCustomer:Ba,categoryFilter:[],checkoutID:""},mutations:{setLoggedIn:function(t,e){t.userLoggedIn=e},setUserFirstName:function(t,e){t.userFirstName=e},setCategoryFilter:function(t,e){t.categoryFilter=e},setCustomer:function(t,e){t.customer=e},setEmail:function(t,e){a["a"].set(t.customer.contact,"email",e)},setWaitingOnProducts:function(t,e){var s=e.slice();a["a"].set(t.customer,"waitingOnProducts",s)},setShoppingBasket:function(t,e){a["a"].set(t.customer,"shoppingBasket",e)},setShoppingBasketSize:function(t,e){a["a"].set(t.metaCustomer,"shoppingBasketSize",e)},setShoppingBasketValue:function(t,e){a["a"].set(t.metaCustomer,"shoppingBasketValue",e)},pushBasketItem:function(t,e){t.customer.shoppingBasket.push(e)},increaseBasketItemQuantity:function(t,e){a["a"].set(t.customer.shoppingBasket[e.index],"quantity",t.customer.shoppingBasket[e.index].quantity+e.quantity)},setBasketItemQuantity:function(t,e){t.customer.shoppingBasket[e.index].quantity=e.quantity},clearBasket:function(t){a["a"].set(t.customer,"shoppingBasket",[]),a["a"].set(t.metaCustomer,"shoppingBasketSize",0),a["a"].set(t.metaCustomer,"shoppingBasketValue",0)},signout:function(t){a["a"].set(t,"customer",Ra),a["a"].set(t.customer,"contact",{}),a["a"].set(t.customer,"shoppingBasket",[]),a["a"].set(t.customer,"orders",[]),a["a"].set(t.customer,"orderOverflow",!1),t.metaCustomer.shoppingBasketSize=0,t.metaCustomer.shoppingBasketValue=0,t.userLoggedIn=!1,t.userFirstName="Guest",t.categoryFilter=[]},setOrders:function(t,e){a["a"].set(t.customer,"orders",e.orders),a["a"].set(t.customer,"orderOverflow",e.orderOverflow)}},actions:{addToBasket:function(t,e){var s=t.commit,a=t.state,r=t.dispatch;if(e.itemArray&&e.itemArray.length>0&&(e.itemArray.forEach(function(t,r){var i=a.customer.shoppingBasket.findIndex(function(e){return e.productID===t.productID});i<0?s("pushBasketItem",e.itemArray[r]):s("increaseBasketItemQuantity",{index:r,quantity:e.itemArray[r].quantity})}),a.userLoggedIn&&e.database)){var i=e.database.collection("customers");i.updateOne({"contact.email":a.customer.contact.email},{$set:{shoppingBasket:a.customer.shoppingBasket}}).catch(function(t){Ea("Failed to update the shopping basket in the database: ".concat(t))})}r("calcBasketStats")},deleteFromBasket:function(t,e){var s=t.commit,a=t.state,r=t.dispatch;if(e.productID){var i=a.customer.shoppingBasket.findIndex(function(t){return t.productID===e.productID});if(i>=0){var n=a.customer.shoppingBasket.slice();if(n.splice(i,1),s("setShoppingBasket",n),r("calcBasketStats"),a.userLoggedIn&&e.database){var o=e.database.collection("customers");o.updateOne({"contact.email":a.customer.contact.email},{$set:{shoppingBasket:n}}).catch(function(t){Ea("Failed to update the shopping basket in the database: ".concat(t))})}}}},updateBasketItemQuantity:function(t,e){var s=t.commit,a=t.state,r=t.dispatch;if(e){var i=a.customer.shoppingBasket.findIndex(function(t){return t.productID===e.productID});if(i>=0&&(s("setBasketItemQuantity",{index:i,quantity:e.quantity}),r("calcBasketStats"),a.userLoggedIn&&e.database)){var n=e.database.collection("customers");n.updateOne({"contact.email":a.customer.contact.email},{$set:{shoppingBasket:a.customer.shoppingBasket}}).catch(function(t){Ea("Failed to update the shopping basket in the database: ".concat(t))})}}},emptyBasket:function(t,e){var s=t.state,a=t.commit;if(a("clearBasket"),s.userLoggedIn&&e){var r=e.collection("customers");r.updateOne({"contact.email":s.customer.contact.email},{$set:{shoppingBasket:s.customer.shoppingBasket}}).catch(function(t){Ea("Failed to update the shopping basket in the database: ".concat(t))})}},calcBasketStats:function(t){var e=t.commit,s=t.state,a=s.customer.shoppingBasket.reduce(function(t,e){return t+e.quantity},0);e("setShoppingBasketSize",a);var r=s.customer.shoppingBasket.reduce(function(t,e){return t+e.quantity*e.price},0);e("setShoppingBasketValue",r)},setUserLoggedIn:function(t,e){var s=t.commit,a=t.state,r=t.dispatch;return s("setLoggedIn",!0),s("setEmail",e.user.profile.email),e.user.profile.firstName?s("setUserFirstName",e.user.profile.firstName):e.user.profile.email&&s("setUserFirstName",e.user.profile.email),new Promise(function(t,i){try{e.database.collection("customers").findOne({"contact.email":e.user.profile.data.email}).then(function(i){if(i){var n=[];a.customer.shoppingBasket.forEach(function(t){n.push(t)}),s("setCustomer",i),r("addToBasket",{database:e.database,itemArray:n}),s("setUserFirstName",i.name.first)}t()},function(t){var e="Error: attempt to read customer document failed: ".concat(t);Ea(e),i(e)})}catch(o){var n="Error: Call to fetch customer document failed: ".concat(o);Ea(n),i(n)}})},refreshCustomer:function(t,e){var s=t.commit,a=t.state;if(a.customer.contact.email)return e.collection("customers").findOne({"contact.email":a.customer.contact.email}).then(function(t){t&&s("setCustomer",t)},function(t){Ea("Error, failed to fetch the customer document: ".concat(t))})},fetchOrders:function(t,e){var s=t.commit,a=t.state,r=e.collection("customers");return r.findOne({"contact.email":a.customer.contact.email},{$projection:{orders:1,orderOverflow:1}}).then(function(t){s("setOrders",t)})},deleteOrder:function(t,e){var s=t.commit,a=t.state;return new Promise(function(t,r){if(e.orderID){var i=a.customer.orders.findIndex(function(t){return t.orderID===e.orderID});if(i>=0){var n=a.customer.orders.slice();n.splice(i,1),s("setOrders",{orders:n,orderOverflow:a.customer.orderOverflow}),e.stitchClient.callFunction("cancelOrder",[e.orderID]).then(function(e){e.result?t():r("Failed to cancel the order: ".concat(e.error))},function(t){r("Cancel order failed: ".concat(t))})}else t()}else r("Order ID not provided")})},unWatch:function(t,e){var s=t.commit,a=t.state;if(e.productID){var r=a.customer.waitingOnProducts.findIndex(function(t){return t===e.productID});if(r>=0){var i=a.customer.waitingOnProducts.slice();if(i.splice(r,1),s("setWaitingOnProducts",i),a.userLoggedIn&&e.database){var n=e.database.collection("customers");n.updateOne({"contact.email":a.customer.contact.email},{$set:{waitingOnProducts:i}}).catch(function(t){Ea("Failed to update the order list in the database: ".concat(t))})}}}}}});new a["a"]({router:Ia,store:Ta,data:{stitchClient:null,database:null},render:function(t){return t(f)}}).$mount("#app")},"5a57":function(t,e,s){"use strict";var a=s("f3f4"),r=s.n(a);r.a},"678a":function(t,e,s){},"75ed":function(t,e,s){"use strict";var a=s("762d"),r=s.n(a);r.a},"762d":function(t,e,s){},"7db8":function(t,e,s){"use strict";var a=s("f8b6"),r=s.n(a);r.a},"7e18":function(t,e,s){"use strict";var a=s("678a"),r=s.n(a);r.a},8932:function(t,e,s){"use strict";var a=s("1692"),r=s.n(a);r.a},"8fd5":function(t,e,s){},"912c":function(t,e,s){"use strict";var a=s("9c35"),r=s.n(a);r.a},9715:function(t,e,s){},"9c35":function(t,e,s){},"9f14":function(t,e,s){"use strict";var a=s("9715"),r=s.n(a);r.a},"9ff1":function(t,e,s){},a0ef:function(t,e,s){"use strict";var a=s("ad7d"),r=s.n(a);r.a},a123:function(t,e,s){"use strict";var a=s("dc4a"),r=s.n(a);r.a},abe2:function(t,e,s){},ad48:function(t,e,s){},ad7d:function(t,e,s){},bac6:function(t,e){t.exports=Stripe},bd78:function(t,e,s){"use strict";var a=s("9ff1"),r=s.n(a);r.a},c316:function(t,e,s){t.exports=s.p+"img/MongoDB_Logo_White_RGB.e2701f1d.png"},c58d:function(t,e,s){},db49:function(t,e){var s={appName:"mongodb-ecommerce",appId:"ecommerce-iukkg",database:"ecommerce",aws:{serviceName:"AWS2",bucket:"ecommerce-mongodb-mugshots",productBucket:"ecommerce-mongodb-products"},stripePublicKey:"pk_test_RkoUKX2VFhJ2hxKW4mNIXrXr00ZUnlTUep",logErrors:!0};t.exports=s},dc4a:function(t,e,s){},e655:function(t,e,s){"use strict";var a=s("8fd5"),r=s.n(a);r.a},e77f:function(t,e,s){"use strict";var a=s("4c92"),r=s.n(a);r.a},e87d:function(t,e,s){"use strict";var a=s("3d00"),r=s.n(a);r.a},e8ce:function(t,e,s){"use strict";var a=s("0a56"),r=s.n(a);r.a},f3f4:function(t,e,s){},f8b6:function(t,e,s){}});
//# sourceMappingURL=app.3d530c42.js.map